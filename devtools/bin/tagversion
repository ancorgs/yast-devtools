#!/bin/bash
# $Id$
usage () {
    echo "tagversion, tag version in git"
    echo "options:"
    echo "  -h, --help:    this help"
}

OPTIONS=`getopt --name $0 --options hnru --longoptions help,echo,echourl,remove -- "$@"` || { usage; exit 1; }
eval set -- "$OPTIONS"
while true; do
    case "$1" in
	--)
	    shift
	    break
	    ;;
	-h|--help)
	    usage
	    exit
	    ;;
    esac
    shift
done

p=`cat RPMNAME`
v=`cat VERSION | tr "." "_"`
if [ -z "$p" -o -z "$v" ]; then
    echo "Cannot find RPMNAME or VERSION in `pwd`"
    exit 1
fi

  # sed -n -e 's///;T;p;q'
  # means: print just the line on which the subst succeeded

BRANCH=`git branch | sed '/^[^\*]/d;s/^\*[[:space:]]*//;'`
if [ "$BRANCH" = "master" ]; then
  t=stable-$v
else
  t=$BRANCH-$v
fi

git tag $t
git push --tags

